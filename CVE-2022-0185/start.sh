#!/bin/bash
#
# build root fs
#

pushd fs
find . -print0 | cpio --null -ov --format=newc | gzip -9 > ../initramfs.cpio.gz
popd

/usr/bin/qemu-system-x86_64 \
-m 2048M \
-cpu kvm64,+smep,+smap \
-kernel ./bzImage \
-initrd ./initramfs.cpio.gz \
-nographic \
-s \
-smp 4,cores=2,threads=2 \
-append "console=ttyS0 quiet kaslr"
